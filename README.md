# AI æ™ºèƒ½é—®ç­”ç³»ç»Ÿ
åŸºäº LangChain å’Œ FastAPI æ„å»ºçš„æ™ºèƒ½å¯¹è¯åº”ç”¨ï¼Œæ”¯ æŒRAG çŸ¥è¯†åº“é—®ç­”ã€æµå¼å“åº”ï¼Œé‡‡ç”¨ Clean Architecture æ¶æ„è®¾è®¡

## âœ¨ åŠŸèƒ½ç‰¹æ€§
- **æ™ºèƒ½å¯¹è¯**ï¼šæ¥å…¥é€šä¹‰åƒé—®å¤§æ¨¡å‹ï¼Œæ”¯æŒå¤šè½®å¯¹è¯ï¼Œä¸Šä¸‹æ–‡è®°å¿†
- **RAG çŸ¥è¯†åº“**ï¼šä¸Šä¼ æ–‡æ¡£æ„å»ºçŸ¥è¯†åº“ï¼ŒåŸºäºæ–‡æ¡£å†…å®¹ç²¾å‡†å›ç­”
- **æ–‡ä»¶ä¸Šä¼ **ï¼šæ”¯æŒ PDFã€TXT æ–‡ä»¶ä¸Šä¼ ï¼Œè‡ªåŠ¨è§£æå…¥åº“
- **æŸ¥è¯¢æ”¹å†™**ï¼šæ”¯æŒè‡ªåŠ¨è§£å†³å¯¹è¯ä¸­çš„æŒ‡ä»£é—®é¢˜ï¼ˆå¦‚â€œå®ƒæ˜¯ä»€ä¹ˆâ€œï¼‰
- **æµå¼å“åº”**ï¼šAI å›å¤é€å­—æ˜¾ç¤ºï¼Œæ‰“å­—æœºæ•ˆæœä½“éªŒ
- **Clean Architecture**ï¼šæ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
- **å¯æ‹”æ’è®¾è®¡**ï¼šè½»æ¾åˆ‡æ¢ä¸åŒçš„ LLM æä¾›å•†

## ğŸ› ï¸ æŠ€æœ¯æ ˆ
| å±‚çº§ | æŠ€æœ¯ |
|-----|------|
|**åç«¯æ¡†æ¶**| FastAPI |
|**AI æ¡†æ¶**| LangChain |
|**LLM**| é€šä¹‰åƒé—®ï¼ˆQwenï¼‰ |
|**Embedding**| DashScope text-embedding-v3 |
|**å‘é‡æ•°æ®åº“**| FAISS |
|**æ–‡æ¡£è§£æ**| pypdf |
|**å‰ç«¯**|HTML + CSS + JavaScript|
|**é…ç½®ç®¡ç†**| Pydantic Settings |
|**å®¹å™¨åŒ–**| Docker + docker-compose|

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Interfaces æ¥å£å±‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Web UI    â”‚  â”‚  REST API   â”‚  â”‚        CLI          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Application åº”ç”¨å±‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    ChatService      â”‚  â”‚    KnowledgeService         â”‚   â”‚
â”‚  â”‚    (å¯¹è¯æœåŠ¡)        â”‚  â”‚    (çŸ¥è¯†åº“æœåŠ¡ + æŸ¥è¯¢æ”¹å†™)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Domain é¢†åŸŸå±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Entities   â”‚  â”‚              Ports                   â”‚ â”‚
â”‚  â”‚ Message      â”‚  â”‚ LLMPort, EmbeddingPort,              â”‚ â”‚
â”‚  â”‚ Conversation â”‚  â”‚ VectorStorePort, MemoryPort          â”‚ â”‚
â”‚  â”‚ DocumentChunkâ”‚  â”‚                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 Infrastructure åŸºç¡€è®¾æ–½å±‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ QwenAdapterâ”‚  â”‚ DashScope  â”‚  â”‚   FAISS    â”‚            â”‚
â”‚  â”‚   (LLM)    â”‚  â”‚ (Embedding)â”‚  â”‚ (Vector DB)â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„
```
ai-qa-project/
â”œâ”€â”€ src/ai_qa/
â”‚   â”œâ”€â”€ domain/                 # é¢†åŸŸå±‚ï¼šå®ä½“å’Œæ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ entities.py         # Message, Conversation, DocumentChunkå®ä½“
â”‚   â”‚   â””â”€â”€ ports.py            # LLMPort, MemoryPort, EmbeddingPort, VectorStorePort
â”‚   â”‚
â”‚   â”œâ”€â”€ application/            # åº”ç”¨å±‚ï¼šä¸šåŠ¡é€»è¾‘ç¼–æ’
â”‚   â”‚   â””â”€â”€ chat_service.py     # èŠå¤©æœåŠ¡
â”‚   â”‚   â””â”€â”€ knowledge_service.py # çŸ¥è¯†åº“æœåŠ¡ï¼ˆRAG + æŸ¥è¯¢æ”¹å†™ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/         # åŸºç¡€è®¾æ–½å±‚ï¼šå¤–éƒ¨æœåŠ¡å®ç°
â”‚   â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”‚   â””â”€â”€ qwen_adapter.py # é€šä¹‰åƒé—®LLMé€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ embedding/
â”‚   â”‚   â”‚   â””â”€â”€ dashscope_embedding.py # é€šä¹‰åƒé—®åµŒå…¥æ¨¡å‹é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ vectorstore/
â”‚   â”‚   â”‚   â””â”€â”€ faiss_store.py  # Meta å‘é‡æ•°æ®åº“ï¼ˆæ”¯æŒæŒä¹…åŒ–ï¼‰
â”‚   â”‚   â”œâ”€â”€ document/
â”‚   â”‚   â”‚   â””â”€â”€ pdf_reader.py   # PDF è§£æ
â”‚   â”‚   â””â”€â”€ memory/
â”‚   â”‚       â””â”€â”€ in_memory.py    # å†…å­˜å­˜å‚¨
â”‚   â”‚
â”‚   â”œâ”€â”€ interfaces/             # æ¥å£å±‚ï¼šå¯¹å¤–æš´éœ²
â”‚   â”‚   â”œâ”€â”€ api/                # FastAPI è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ cli/                # å‘½ä»¤è¡Œå…¥å£
â”‚   â”‚   â””â”€â”€ web/                # å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                 # è¯·æ±‚/å“åº”æ¨¡å‹
â”‚   â”‚   â””â”€â”€ schemas.py
â”‚   â”‚
â”‚   â””â”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚       â””â”€â”€ settings.py
â”‚
â”œâ”€â”€ data/                       # çŸ¥è¯†åº“æŒä¹…åŒ–æ•°æ®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ pyproject.toml              # é¡¹ç›®é…ç½®
â”œâ”€â”€ requirements.txt            # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹
### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/your-username/ai-qa-project.git
cd ai-qa-project
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
conda create -n ai-qa python=3.12 -y
conda activate ai-qa
```

### 3. å®‰è£…ä¾èµ–
```bash
pip install -e .
```

### 4. é…ç½®ç¯å¢ƒå˜é‡
å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶å¹¶å¡«å…¥ä½ çš„ API Keyï¼š
```bash
cp .env.example .env
```

ç¼–è¾‘ '.env' æ–‡ä»¶ï¼š
```env
LLM_API_KEY=your-api-key-here
LLM_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
LLM_MODEL_NAME=qwen-turbo
EMBEDDING_MODEL_NAME=text-embedding-v3
KNOWLEDGE_PERSIST_DIR=./data/knowledge
```

### 5. å¯åŠ¨æœåŠ¡
```bash
python run_api.py
```

### 6. è®¿é—®åº”ç”¨

- Web ç•Œé¢ï¼šhttp://localhost:8000
- API æ–‡æ¡£ï¼šhttp://localhost:8000/docs

## ğŸ³ Docker éƒ¨ç½²

### ä½¿ç”¨ docker-composeï¼ˆæ¨èï¼‰
```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

### æ‰‹åŠ¨æ„å»ºè¿è¡Œ
```bash
# æ„å»ºé•œåƒ
docker build -t ai-qa-app .

# è¿è¡Œå®¹å™¨
docker run -p 8000:8000 --env-file .env ai-qa-app
```

## ğŸ“– API æ–‡æ¡£
### å¯¹è¯æ¥å£

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|-----|------|------|
| POST | `/api/v1/conversations/{session_id}/messages` | å‘é€æ¶ˆæ¯ |
| POST | `/api/v1/conversations/{session_id}/messages/stream` | å‘é€æ¶ˆæ¯ï¼ˆæµå¼ï¼‰ |
| GET | `/api/v1/conversations/{session_id}/messages` | è·å–å¯¹è¯å†å² |
| GET | `/api/v1/conversations` | è·å–ä¼šè¯åˆ—è¡¨ |
| DELETE | `/api/v1/conversations/{session_id}` | åˆ é™¤ä¼šè¯ |

### çŸ¥è¯†åº“æ¥å£

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|-----|------|------|
| POST | `/api/v1/knowledge/documents` | æ·»åŠ æ–‡æœ¬åˆ°çŸ¥è¯†åº“ |
| POST | `/api/v1/knowledge/documents/upload` | ä¸Šä¼ æ–‡ä»¶ï¼ˆPDF/TXTï¼‰ |
| GET | `/api/v1/knowledge/documents` | è·å–æ–‡æ¡£åˆ—è¡¨ |
| DELETE | `/api/v1/knowledge/documents` | æ¸…ç©ºçŸ¥è¯†åº“ |
| GET | `/api/v1/knowledge/status` | è·å–çŸ¥è¯†åº“çŠ¶æ€ |

### RAG é—®ç­”

å‘é€æ¶ˆæ¯æ—¶è®¾ç½® `use_knowledge: true` å³å¯å¯ç”¨çŸ¥è¯†åº“é—®ç­”ï¼š
```json
{
  "content": "Python æ˜¯è°å‘æ˜çš„ï¼Ÿ",
  "use_knowledge": true
}
```

è¯¦ç»†æ–‡æ¡£è¯·è®¿é—® `/docs` æŸ¥çœ‹ Swagger UIã€‚

## ğŸ”§ æ ¸å¿ƒè®¾è®¡

### Clean Architecture

é‡‡ç”¨æ•´æ´æ¶æ„ï¼Œä¾èµ–æ–¹å‘ä»å¤–åˆ°å†…ï¼š

- **é¢†åŸŸå±‚**ï¼šå®šä¹‰ä¸šåŠ¡å®ä½“å’Œæ¥å£ï¼ˆPortsï¼‰
- **åº”ç”¨å±‚**ï¼šç¼–æ’ä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¾èµ–å…·ä½“æŠ€æœ¯
- **åŸºç¡€è®¾æ–½å±‚**ï¼šå®ç°æ¥å£ï¼ˆAdaptersï¼‰ã€å¯¹æ¥å¤–éƒ¨æœåŠ¡
- **æ¥å£å±‚**ï¼šæš´éœ² APIã€CLIã€Web ç­‰å…¥å£

### RAG æµç¨‹
```
ç¦»çº¿å»ºåº“ï¼šæ–‡æ¡£ â†’ åˆ‡åˆ† â†’ Embedding â†’ å‘é‡æ•°æ®åº“
åœ¨çº¿é—®ç­”ï¼šé—®é¢˜ â†’ æŸ¥è¯¢æ”¹å†™ï¼ˆè§£å†³æŒ‡ä»£ï¼‰ â†’ Embedding â†’ æ£€ç´¢ Top-K â†’ æ‹¼æ¥ Prompt â†’ LLM ç”Ÿæˆ
```


## ğŸ—ºï¸ æœªæ¥è®¡åˆ’
- [x] RAG æ–‡æ¡£é—®ç­”ï¼šä¸Šä¼  PDF æ–‡æ¡£ï¼ŒåŸºäºæ–‡æ¡£å†…å®¹å›ç­”
- [x] Docker éƒ¨ç½²ï¼šå®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ
- [x] ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼šå¤šç”¨æˆ·æ”¯æŒ
- [x] æŒä¹…åŒ–å­˜å‚¨ï¼šæ”¯æŒ PostgreSQLæ•°æ®åº“å­˜å‚¨å¯¹è¯
- [ ] å¤šæ¨¡å‹æ”¯æŒï¼šæ·»åŠ  OpenAIã€Claude ç­‰æ¨¡å‹
- [ ] Toolsæ”¯æŒï¼šæ”¯æŒ æœ¬åœ°å·¥å…·å’Œ MCP å·¥å…·è°ƒç”¨
- [ ] Agentæ”¯æŒ


## ğŸ“„ è®¸å¯è¯

MIT License